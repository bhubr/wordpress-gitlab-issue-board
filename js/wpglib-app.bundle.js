webpackJsonp([0],{53:function(e,t,n){angular.module("WordPressGitlabIssueBoard",["ui.router","ngLodash"]).component("board",n(54)).component("tools",n(55)).factory("dataService",n(56)).config(n(57)).run(function(){console.log("running WordPressGitlabIssueBoard app")})},54:function(e,t){function n(e,t,n,s,o){function i(e){e.issues=u.issues.filter(function(t){return t.issue_cat.indexOf(e.id)>-1}),e.closedIssues=e.issues.filter(function(e){return"closed"===e.gl_state})}function r(e){e.childCats=u.issueCats.filter(function(t){return t.parent===e.id}),e.childCats.forEach(i)}var u=this;u.stateFilter="opened",u.filteredIssues=[],u.rootCats=[],u.issueEditing=null,u.parentCatEditing=null,u.data={listName:""},u.filterIssues=function(e){e&&(u.stateFilter=e),u.filteredIssues="all"===u.stateFilter?u.issues:u.issues.filter(function(e){return e.gl_state===u.stateFilter&&0===e.issue_cat.length})},u.createList=function(){console.log("createList",u.projectId),o.createList({name:u.data.listName,wp_project_id:u.projectId}).then(function(e){console.log(e),u.rootCats.push(e)})},n(function(){u.issues=u.board.issues,u.issueCats=u.board.issueCats,u.issueLabels=u.board.issueLabels,u.projectId=u.board.projectId,u.rootCats=u.issueCats.filter(function(e){return 0===e.parent}),u.rootCats.forEach(r),console.log("board content",u,u.board),u.filterIssues("opened")},50),u.dropped=function(e,t){var n=e.target,i=n.id.substr("issue-cat-".length),r=parseInt(i,10),a=t.draggable,c=a[0].id.substr("issue-".length),d=parseInt(c,10),l=s.find(u.issues,{id:d}),p=u.issues.indexOf(l);l.issue_cat.push(r),o.updateResource("issue",l).then(function(e){s.find(u.issueCats,{id:r}).issues.push(e),u.issues[p]=e,u.filterIssues()})},u.editIssue=function(e,t){null!==u.parentCatEditing&&(u.parentCatEditing._isEditing=!1),u.parentCatEditing=e,e._isEditing=!0,u.issueEditing=t||{_title:"",_description:""},console.log("editIssue",u.issueEditing)},u.cancelEditing=function(){u.parentCatEditing._isEditing=!1,u.parentCatEditing=null,u.issueEditing=null},u.saveIssue=function(){var t=u.issueEditing;u.parentCatEditing._isEditing=!1,t.title=t._title,t.content=t._description,delete t._title,delete t._description,t.id?o.updateResource("issue",t).then(function(n){var o=s.find(u.issues,{id:t.id}),r=u.issues.indexOf(o);u.issues[r]=n,i(u.parentCatEditing),u.cancelEditing(),e.$emit("alertOn",{class:"success",text:"Issue updated"})}):(t.status="publish",t.issue_cat=[u.parentCatEditing.id],o.createResource("issue",t).then(function(t){u.issues.push(t),i(u.parentCatEditing),u.cancelEditing(),e.$emit("alertOn",{class:"success",text:"Issue created"})}))}}n.$inject=["$rootScope","$http","$timeout","lodash","dataService"],e.exports={templateUrl:window.wpglib.templatesRoot+"/board.html",controller:n,bindings:{board:"="}}},55:function(e,t){function n(e,t,n,s,o){var i=this;i.fields={catName:""},i.syncProjects=function(){o.syncProjects().then(function(e){console.log("got projects",e),i.projects=e})},i.syncIssues=function(e){o.syncIssues(e).then(function(e){console.log("got issues",e),i.issues=e})},i.createIssueCat=function(e){console.log("createIssueCat",i.fields),o.createResource("issue_cat",{wp_project_id:e,name:i.fields.catName}).then(function(e){console.log("created resource",e)})},i.cleanup=function(){t({method:"DELETE",url:window.wpglib.siteRoot+"/wp-json/wpglib/v1/cleanup"}).then(function(e){console.log("after cleanup",e.data)})}}n.$inject=["$rootScope","$http","$timeout","lodash","dataService"],e.exports={templateUrl:window.wpglib.templatesRoot+"/tools.html",controller:n,bindings:{issues:"=",projects:"="}}},56:function(e,t){function n(e,t,n,s){function o(e,n){return t({method:"POST",url:window.wpglib.siteRoot+"/wp-json/wp/v2/"+e,data:n,headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function i(e,n){return t({method:"PUT",url:window.wpglib.siteRoot+"/wp-json/wp/v2/"+e+"/"+n.id,data:n,headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function r(e,n){var s=window.wpglib.siteRoot+"/wp-json/wp/v2/"+e;return n&&(s+="?"+serialize(n)),console.log("getResources",e,n,s),t.get(s).then(function(e){return e.data})}function u(e,t,s){return s||(t.page=1,s=[]),r(e,t).then(function(o){return s=s.concat(o),console.log("got page",t.page,o.length+" items","CARRY: "+s.length+" items"),o.length<100?n.when(s):(t.page++,console.log("proceed to page",t.page),u(e,t,s))})}function a(){return t({method:"POST",url:window.wpglib.siteRoot+"/wp-json/wpglib/v1/sync-projects",data:{},headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function c(e,n){return t({method:"POST",url:window.wpglib.siteRoot+"/wp-json"+e,data:n,headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function d(e){return c("/wp/v2/issue_cat",e)}function l(e){return t({method:"POST",url:window.wpglib.siteRoot+"/wp-json/wpglib/v1/sync-issues/"+e,headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function p(e){return t.get(window.wpglib.siteRoot+"/wp-json/wpglib/v1/board/"+e).then(function(e){return e.data})}function g(){return u("issue",{per_page:100,orderby:"date",order:"asc"})}function f(){return r("project",{per_page:100})}function h(){return r("issue_cat",{per_page:100})}function w(){return r("issue_label")}return serialize=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},{getBoard:p,createList:d,getProjects:f,syncProjects:a,syncIssues:l,getIssues:g,getIssueCats:h,getIssueLabels:w,getResources:r,createResource:o,updateResource:i}}n.$inject=["$rootScope","$http","$q","lodash"],e.exports=n},57:function(e,t){function n(e,t,n,s){var o=localStorage.getItem("defaultProjectId");null!==o?o=parseInt(o,10):wpglib.projects.length>0&&(o=wpglib.projects[0].id);var i=o?"/":"/tools";t.otherwise(i),[{name:"board",url:"/",component:"board",resolve:{board:["dataService",function(e){return e.getBoard(o).then(function(e){return console.log("board data",e),Object.assign(e,{projectId:o})})}]}},{name:"tools",url:"/tools",component:"tools",resolve:{issues:["dataService",function(e){return e.getIssues()}],projects:["dataService",function(e){return e.getProjects()}]}}].forEach(function(t){e.state(t)})}n.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider"],e.exports=n}},[53]);