webpackJsonp([0],{53:function(e,t,s){angular.module("WordPressGitlabIssueBoard",["ui.router","ngLodash"]).component("board",s(54)).component("tools",s(55)).factory("dataService",s(56)).config(s(57)).run(function(){console.log("running WordPressGitlabIssueBoard app")})},54:function(e,t){function s(e,t,s,n,i){function o(e){e.issues=u.issues.filter(function(t){return t.issue_cat.indexOf(e.id)>-1}),e.closedIssues=e.issues.filter(function(e){return"closed"===e.gl_state})}function r(e){e.childCats=u.issueCats.filter(function(t){return t.parent===e.id}),e.childCats.forEach(o)}var u=this;u.stateFilter="opened",u.filteredIssues=[],u.rootCats=[],u.issueEditing=null,u.parentCatEditing=null,u.filterIssues=function(e){e&&(u.stateFilter=e),u.filteredIssues="all"===u.stateFilter?u.issues:u.issues.filter(function(e){return e.gl_state===u.stateFilter&&0===e.issue_cat.length})},s(function(){u.rootCats=u.issueCats.filter(function(e){return 0===e.parent}),u.rootCats.forEach(r),u.filterIssues("opened")},50),u.dropped=function(e,t){var s=e.target,o=s.id.substr("issue-cat-".length),r=parseInt(o,10),a=t.draggable,c=a[0].id.substr("issue-".length),d=parseInt(c,10),l=n.find(u.issues,{id:d}),p=u.issues.indexOf(l);l.issue_cat.push(r),i.updateResource("issue",l).then(function(e){n.find(u.issueCats,{id:r}).issues.push(e),u.issues[p]=e,u.filterIssues()})},u.editIssue=function(e,t){null!==u.parentCatEditing&&(u.parentCatEditing._isEditing=!1),u.parentCatEditing=e,e._isEditing=!0,u.issueEditing=t||{_title:"",_description:""},console.log("editIssue",u.issueEditing)},u.cancelEditing=function(){u.parentCatEditing._isEditing=!1,u.parentCatEditing=null,u.issueEditing=null},u.saveIssue=function(){var t=u.issueEditing;u.parentCatEditing._isEditing=!1,t.title=t._title,t.content=t._description,delete t._title,delete t._description,t.id?i.updateResource("issue",t).then(function(s){var i=n.find(u.issues,{id:t.id}),r=u.issues.indexOf(i);u.issues[r]=s,o(u.parentCatEditing),u.cancelEditing(),e.$emit("alertOn",{class:"success",text:"Issue updated"})}):(t.status="publish",t.issue_cat=[u.parentCatEditing.id],i.createResource("issue",t).then(function(t){u.issues.push(t),o(u.parentCatEditing),u.cancelEditing(),e.$emit("alertOn",{class:"success",text:"Issue created"})}))}}s.$inject=["$rootScope","$http","$timeout","lodash","dataService"],e.exports={templateUrl:window.templatesRoot+"/board.html",controller:s,bindings:{issues:"=",issueCats:"=",issueLabels:"="}}},55:function(e,t){function s(e,t,s,n,i){var o=this;o.fields={catName:""},o.syncProjects=function(){i.syncProjects().then(function(e){console.log("got projects",e),o.projects=e})},o.syncIssues=function(e){i.syncIssues(e).then(function(e){console.log("got issues",e),o.issues=e})},o.createIssueCat=function(e){console.log("createIssueCat",o.fields),i.createResource("issue_cat",{wp_project_id:e,name:o.fields.catName}).then(function(e){console.log("created resource",e)})},o.cleanup=function(){t({method:"DELETE",url:window.siteRoot+"/wp-json/wpglib/v1/cleanup"}).then(function(e){console.log("after cleanup",e.data)})}}s.$inject=["$rootScope","$http","$timeout","lodash","dataService"],e.exports={templateUrl:window.templatesRoot+"/tools.html",controller:s,bindings:{issues:"=",projects:"="}}},56:function(e,t){function s(e,t,s,n){function i(e,s){return t({method:"POST",url:window.siteRoot+"/wp-json/wp/v2/"+e,data:s,headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function o(e,s){return t({method:"PUT",url:window.siteRoot+"/wp-json/wp/v2/"+e+"/"+s.id,data:s,headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function r(e,s){var n=window.siteRoot+"/wp-json/wp/v2/"+e;return s&&(n+="?"+serialize(s)),console.log("getResources",e,s,n),t.get(n).then(function(e){return e.data})}function u(e,t,n){return n||(t.page=1,n=[]),r(e,t).then(function(i){return n=n.concat(i),console.log("got page",t.page,i.length+" items","CARRY: "+n.length+" items"),i.length<100?s.when(n):(t.page++,console.log("proceed to page",t.page),u(e,t,n))})}function a(){return t({method:"POST",url:window.siteRoot+"/wp-json/wpglib/v1/sync-projects",data:{},headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function c(e){return t({method:"POST",url:window.siteRoot+"/wp-json/wpglib/v1/sync-issues/"+e,headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then(function(e){return e.data})}function d(){return u("issue",{per_page:100,orderby:"date",order:"asc"})}function l(){return r("project",{per_page:100})}function p(){return r("issue_cat",{per_page:100})}function f(){return r("issue_label")}return serialize=function(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")},{getProjects:l,syncProjects:a,syncIssues:c,getIssues:d,getIssueCats:p,getIssueLabels:f,getResources:r,createResource:i,updateResource:o}}s.$inject=["$rootScope","$http","$q","lodash"],e.exports=s},57:function(e,t){function s(e,t,s,n){t.otherwise("/tools"),[{name:"board",url:"/",component:"board",resolve:{issues:["dataService",function(e){return e.getIssues()}],issueCats:["dataService",function(e){return e.getIssueCats()}],issueLabels:["dataService",function(e){return e.getIssueLabels()}]}},{name:"tools",url:"/tools",component:"tools",resolve:{issues:["dataService",function(e){return e.getIssues()}],projects:["dataService",function(e){return e.getProjects()}]}}].forEach(function(t){e.state(t)})}s.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider"],e.exports=s}},[53]);